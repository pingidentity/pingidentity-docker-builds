################################################
# The purpose of the integration test below is
# to verify replication between two
# instances of PingDirectory with the latest
# release for the azul JVM on the x86_64 runner
intel.pd-repl.azul:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pd-replicated --image-tag-jvm az11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pd-replicated*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 3920000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $PING_IDENTITY_SNAPSHOT =~ /--snapshot/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify replication between two
# instances of PingDirectory with the latest
# release for the liberica JVM on the x86_64 runner
intel.pd-repl.liberica:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pd-replicated --image-tag-jvm al11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pd-replicated*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 3920000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify replication between two
# instances of PingDirectory with the latest
# release for the liberica JVM on the aarch64 runner
arm.pd-repl.liberica:
  stage: test.integration
  image: $RUNNER_IMAGE_AARCH64
  tags:
    - platform=aarch64
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pd-replicated --image-tag-jvm al11 --image-tag-arch aarch64
  retry: 1
  only:
    changes:
      - integration_tests/**/pd-replicated*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 5880000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingAccess, PingFederate and PingDirectory
# integrate together into an end to end test
# for the azul JVM on the x86_64 runner
intel.pa-pf-pd.azul:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pa-pf-pd --image-tag-jvm az11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pa-pf-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingaccess/**/*
      - pingdirectory/**/*
      - pingfederate/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 250m
    KUBERNETES_CPU_LIMIT: 500m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 3920000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $PING_IDENTITY_SNAPSHOT =~ /--snapshot/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingaccess(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingfederate(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingAccess, PingFederate and PingDirectory
# integrate together into an end to end test
# for the liberica x86 JVM on a RHEL shim in
# FIPS mode
intel.pf-pd-fips.liberica:
  stage: test.integration
  script:
    - SHIM=redhat_ubi_ubi8_8.3 ci_scripts/run_integration.sh pa-pf-pd-FIPS.latest rl11
  only:
    changes:
      - integration_tests/**/pa-pf-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingaccess/**/*
      - pingdirectory/**/*
      - pingfederate/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 2850m
    KUBERNETES_CPU_LIMIT: 2850m
    KUBERNETES_MEMORY_REQUEST: 1960000000
    KUBERNETES_MEMORY_LIMIT: 1960000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $PING_IDENTITY_SNAPSHOT =~ /--snapshot/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingaccess(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingfederate(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingAccess, PingFederate and PingDirectory
# integrate together into an end to end test
# for the liberica JVM on the x86_64 runner
intel.pa-pf-pd.liberica:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pa-pf-pd --image-tag-jvm al11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pa-pf-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingaccess/**/*
      - pingdirectory/**/*
      - pingfederate/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 2850m
    KUBERNETES_CPU_LIMIT: 2850m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 3920000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingaccess(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingfederate(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingAccess, PingFederate and PingDirectory
# integrate together into an end to end test
# for the liberica JVM on the aarch64 runner
arm.pa-pf-pd.liberica:
  stage: test.integration
  image: $RUNNER_IMAGE_AARCH64
  tags:
    - platform=aarch64
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pa-pf-pd --image-tag-jvm al11 --image-tag-arch aarch64
  retry: 1
  only:
    changes:
      - integration_tests/**/pa-pf-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingaccess/**/*
      - pingdirectory/**/*
      - pingfederate/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 5880000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingaccess(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingfederate(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingDataSync and PingDirectory
# integrate together into an end to end test
# for the azul JVM on the x86_64 runner
intel.pds-pd.azul:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pds-pd --image-tag-jvm az11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pds-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingdatasync/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 3920000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $PING_IDENTITY_SNAPSHOT =~ /--snapshot/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdatasync(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingDataSync and PingDirectory
# integrate together into an end to end test
# for the liberica JVM on the x86_64 runner
intel.pds-pd.liberica:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pds-pd --image-tag-jvm al11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pds-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingdatasync/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 3920000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdatasync(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingDataSync and PingDirectory
# integrate together into an end to end test
# for the liberica JVM on the aarch64 runner
arm.pds-pd.liberica:
  stage: test.integration
  image: $RUNNER_IMAGE_AARCH64
  tags:
    - platform=aarch64
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pds-pd --image-tag-jvm al11 --image-tag-arch aarch64
  retry: 1
  only:
    changes:
      - integration_tests/**/pds-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingdatasync/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 5880000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdatasync(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingDirectoryProxy and PingDirectory
# integrate together into an end to end test
# for the azul JVM on the x86_64 runner
intel.pdp-pd.azul:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pdp-pd --image-tag-jvm az11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pdp-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingdirectoryproxy/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 5880000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $PING_IDENTITY_SNAPSHOT =~ /--snapshot/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdatasync(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingDirectoryProxy and PingDirectory
# integrate together into an end to end test
# for the liberica JVM on the x86_64 runner
intel.pdp-pd.liberica:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pdp-pd --image-tag-jvm al11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pdp-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingdirectoryproxy/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 5880000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdatasync(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingDirectoryProxy and PingDirectory
# integrate together into an end to end test
# for the liberica JVM on the aarch64 runner
arm.pdp-pd.liberica:
  stage: test.integration
  image: $RUNNER_IMAGE_AARCH64
  tags:
    - platform=aarch64
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pdp-pd --image-tag-jvm al11 --image-tag-arch aarch64
  retry: 1
  only:
    changes:
      - integration_tests/**/pdp-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingdirectoryproxy/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 3920000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdatasync(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingDataGovernance and PingDirectory
# integrate together into an end to end test
# for the azul JVM on the x86_64 runner
intel.pdg-pd.azul:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pdg-pd --image-tag-jvm az11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pdg-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingdatagovernance/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 3920000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $PING_IDENTITY_SNAPSHOT =~ /--snapshot/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdatagovernance(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingDataGovernance and PingDirectory
# integrate together into an end to end test
# for the liberica JVM on the x86_64 runner
intel.pdg-pd.liberica:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pdg-pd --image-tag-jvm al11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pdg-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingdatagovernance/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 3920000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $PING_IDENTITY_SNAPSHOT =~ /--snapshot/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdatagovernance(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingDataGovernance and PingDirectory
# integrate together into an end to end test
# for the liberica JVM on the aarch64 runner
arm.pdg-pd.liberica:
  stage: test.integration
  image: $RUNNER_IMAGE_AARCH64
  tags:
    - platform=aarch64
  script:
    - ci_scripts/run_helm_integration.sh --integration-test pdg-pd --image-tag-jvm al11  --image-tag-arch aarch64
  retry: 1
  only:
    changes:
      - integration_tests/**/pdg-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingdatagovernance/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 5880000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $PING_IDENTITY_SNAPSHOT =~ /--snapshot/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingdatagovernance(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingAuthorize and PingDirectory
# integrate together into an end to end test
# for the azul JVM on the x86_64 runner
intel.paz-pd.azul:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test paz-pd --image-tag-jvm az11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pdg-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingauthorize/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 3920000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $PING_IDENTITY_SNAPSHOT =~ /--snapshot/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingauthorize(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingAuthorize and PingDirectory
# integrate together into an end to end test
# for the liberica JVM on the x86_64 runner
intel.paz-pd.liberica:
  stage: test.integration
  script:
    - ci_scripts/run_helm_integration.sh --integration-test paz-pd --image-tag-jvm al11 --image-tag-arch x86_64
  retry: 1
  only:
    changes:
      - integration_tests/**/pdg-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingauthorize/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 3920000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingauthorize(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingAuthorize and PingDirectory
# integrate together into an end to end test
# for the liberica JVM on the aarch64 runner
arm.paz-pd.liberica:
  stage: test.integration
  image: $RUNNER_IMAGE_AARCH64
  tags:
    - platform=aarch64
  script:
    - ci_scripts/run_helm_integration.sh --integration-test paz-pd --image-tag-jvm al11 --image-tag-arch aarch64
  retry: 1
  only:
    changes:
      - integration_tests/**/pdg-pd*
      - pingbase/**/*
      - pingcommon/**/*
      - pingdatacommon/**/*
      - pingdirectory/**/*
      - pingauthorize/**/*
      - ci_scripts/*
      - pingjvm/*
      - .gitlab-ci.yml
  variables:
    KUBERNETES_CPU_REQUEST: 1900m
    KUBERNETES_CPU_LIMIT: 1900m
    KUBERNETES_MEMORY_REQUEST: 3920000000
    KUBERNETES_MEMORY_LIMIT: 5880000000
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingdirectory(?:$|,)/i && $BUILD_PRODUCT !~ /(?:^|,)pingauthorize(?:$|,)/i

################################################
# The purpose of the integration test below is
# to verify PingIntelligence
# works in an end to end test
# on the x86_64 runner
intel.pi-basic.latest:
  stage: test.integration
  script:
    - ci_scripts/run_integration.sh pi-basic
  only:
    changes:
      - integration_tests/**/pi-basic*
      - pingbase/**/*
      - pingcommon/**/*
      - pingintelligence/**/*
      - ci_scripts/*
      - .gitlab-ci.yml
  except:
    variables:
      - $CI_COMMIT_REF_NAME =~ /^workspace.*/
      - $CI_COMMIT_MESSAGE =~ /\[skip build\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip products\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip tests\]/
      - $CI_COMMIT_MESSAGE =~ /\[skip integration\]/
      - $PING_IDENTITY_SNAPSHOT =~ /--snapshot/
      - $BUILD_PRODUCT && $BUILD_PRODUCT !~ /(?:^|,)pingintelligence(?:$|,)/i
